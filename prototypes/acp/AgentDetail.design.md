# Agent 详情页设计说明

## 布局

```
┌─────────────────────────────────────────────┐
│  ← 返回监控面板                               │
├────────────────────────┬────────────────────┤
│  对话历史 (60%)         │ 状态侧边栏 (40%)    │
│                        │                    │
│  [System] 消息          │ ┌──基本信息──┐      │
│  [User] 消息            │ │ ID/模型/角色│      │
│  [Agent] 回复           │ └───────────┘      │
│    └ 🔧 tool_call      │ ┌──统计──────┐      │
│    └ 🔧 tool_call      │ │ Token/消息数│      │
│                        │ └───────────┘      │
│  ···无限滚动···         │ ┌──定时任务──┐      │
│                        │ │ cron列表    │      │
│                        │ └───────────┘      │
│                        │ ┌──发送消息──┐      │
│                        │ │ [TextArea] │      │
│                        │ │ [发送按钮]  │      │
│                        │ └───────────┘      │
└────────────────────────┴────────────────────┘
```

## 关键决策

### 左右分栏 60/40
- 对话历史是核心信息，占大部分空间
- 侧边栏是辅助信息 + 操作入口
- 使用 flex: 6/4 比例，非固定像素，适应不同屏幕

### Chat 消息气泡
- **User**: 右对齐，蓝色半透明背景
- **Assistant**: 左对齐，深灰背景 (#1f1f1f)
- **System**: 右对齐，黄色半透明背景
- 角色通过 Tag 标识（图标 + 文字 + 颜色）

### Tool Call 折叠
- 默认折叠显示：工具名 + 参数摘要（≤200字符）
- 点击 Collapse 展开完整 JSON
- 结果超过 500 字符截断，带省略号
- 使用 `ghost` 折叠面板，减少视觉噪音

### 消息发送
- TextArea 支持 Shift+Enter 换行，Enter 直接发送
- 乐观更新：发送后立即插入本地消息
- 发送中按钮 loading 状态

## 状态处理

| 状态 | 表现 |
|------|------|
| 加载中 | 对话区 Skeleton，侧边栏 Skeleton |
| 空对话 | Empty "暂无对话记录" |
| 加载失败 | 顶部 Alert |
| 发送失败 | antMessage.error 提示 |

## 刷新策略
- 5s 轮询 `/api/agents/:id/history`
- 新消息到达自动滚动到底部（smooth scroll）
- 刷新不打断用户正在阅读历史（仅追加新消息）
