# 2026-02-22

## 记忆管理架构设计（凌晨，第一优先级）

### 背景
- 泽斌指出：跟我合作这么久，不清楚我到底记得什么不记得什么
- 发现PM/UX/Alice完全没有MEMORY.md——因为我写AGENTS.md时漏了记忆规则
- 原因链：AGENTS.md没写规则→agent不知道要维护→heartbeat是空的→只被工作流调用没有闲暇时间

### Lessons问题讨论
- **问题2（字段设计）已确认**：context_sufficient/context_gap/obstacles/reusable_approach 4字段，CC已完成开发（commit 5d6e75c）
- **问题1（浓缩/知识库/分发机制）继续讨论**
  - 泽斌认为这不是简单的"压缩lessons注入prompt"，关系到整个知识库建立+OpenClaw架构+人类学习机制
  - 需要综合考虑设计

### 行业调研
- **Letta MemFS**：system/目录永远在context + git版本控制 + sleep-time反思 + defrag碎片整理
- **OpenClaw Memory v2**（官方研究未发布）：Retain/Recall/Reflect + bank/结构化知识 + 实体页
- **Anthropic Context Engineering**：context rot + 最小有效context + progressive disclosure + just-in-time retrieval

### 落地动作（从Lyra自己开始）
1. ✅ 创建 bank/ 知识库目录（acp.md/plm.md/team.md/infra.md）
2. ✅ MEMORY.md重构：7.8KB → 0.9KB（精简88%，细节移到bank/）
3. ✅ AGENTS.md更新：加入完整的记忆管理规则（文件层次、写入规则、维护规则）
4. ✅ 创建 shared/lessons/ 目录（未来跨agent共享知识用）
5. 待做：配置memorySearch.extraPaths（需泽斌批准改OpenClaw config）
6. 待做：PM/UX/Alice的AGENTS.md更新+MEMORY.md初始化
7. 待做：设置记忆整理cron job

### CC完成Lessons基础功能
- commit 5d6e75c: feat(acp): lessons auto-accumulation system for workflow steps
- 改动：7个文件，+185行
- 新增：StepLesson实体、lesson_handler、plugin tool更新
- 暂未实现：condensed_lessons浓缩机制（问题1待讨论）
- 有pre-existing测试失败（nil gateway panic，不是本次引起）
