# Task Breakdown: Agent Control Panel

PRD: `/docs/prd/agent-control-panel.md`

---

## P0 ä»»åŠ¡åˆ—è¡¨ï¼ˆAgentç›‘æ§ + è¯¦æƒ…é¡µ + è®¤è¯ï¼‰

### Task 1: [åŸºç¡€] é¡¹ç›®è„šæ‰‹æ¶ + SQLite + è®¤è¯

**æè¿°ï¼š**
åˆå§‹åŒ– ACP é¡¹ç›®ï¼Œæ­å»º Go åç«¯éª¨æ¶ + React å‰ç«¯éª¨æ¶ + SQLite è¿æ¥ + å¯†ç è®¤è¯ã€‚

**å…·ä½“å·¥ä½œï¼š**
- åˆ›å»º `/home/claw/.openclaw/workspace/agent-control-panel/` ç›®å½•
- Go module åˆå§‹åŒ–ï¼ˆ`github.com/bitfantasy/agent-control-panel`ï¼‰
- é¡¹ç›®ç»“æ„ï¼š`cmd/acp/main.go` + `internal/acp/{entity,handler,service,repository,gateway}/`
- SQLite è¿æ¥ + è‡ªåŠ¨å»ºè¡¨ï¼ˆagents, tasks, workflows, workflow_versions, workflow_runs, workflow_step_runs, system_logs å…¨éƒ¨å»ºå¥½ï¼‰
- Gin è·¯ç”±æ¡†æ¶ + CORS ä¸­é—´ä»¶
- å¯†ç è®¤è¯ï¼š`POST /api/auth/login` â†’ JWT tokenï¼Œç¯å¢ƒå˜é‡ `ACP_PASSWORD` é…ç½®å¯†ç 
- JWT ä¸­é—´ä»¶ä¿æŠ¤ `/api/*` è·¯ç”±
- React å‰ç«¯è„šæ‰‹æ¶ï¼šVite + React + TypeScript + Ant Design 5.x + React Router
- å‰ç«¯ç™»å½•é¡µ
- Go é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆserve `web/` ç›®å½•ï¼‰
- Makefileï¼š`make build-web`ã€`make build`ã€`make dev`
- `.env` æ–‡ä»¶æ¨¡æ¿

**å‚è€ƒï¼š**
- PLM é¡¹ç›®ç»“æ„ï¼š`/home/claw/.openclaw/workspace/cmd/plm/main.go`
- PLM handler æ¨¡å¼ï¼š`/home/claw/.openclaw/workspace/internal/plm/handler/handler.go`
- PLM ä¸­é—´ä»¶ï¼š`/home/claw/.openclaw/workspace/internal/middleware/middleware.go`

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] `go build -o bin/acp ./cmd/acp/` ç¼–è¯‘æˆåŠŸ
- [ ] å¯åŠ¨åè®¿é—® `:3001` çœ‹åˆ°å‰ç«¯ç™»å½•é¡µ
- [ ] ç™»å½•åæ‹¿åˆ° JWTï¼Œæœªè®¤è¯è¯·æ±‚è¿”å› 401
- [ ] SQLite æ•°æ®åº“æ–‡ä»¶è‡ªåŠ¨åˆ›å»ºï¼Œæ‰€æœ‰è¡¨å»ºå¥½

**ä¾èµ–ï¼š** æ— 
**å¤æ‚åº¦ï¼š** M
**ä¼˜å…ˆçº§ï¼š** P0

---

### Task 2: [åç«¯] OpenClaw Gateway WebSocket å®¢æˆ·ç«¯

**æè¿°ï¼š**
å®ç° Gateway WebSocket å®¢æˆ·ç«¯ï¼Œå°è£… sessions_list / sessions_history / sessions_send / session_status / cron äº”ä¸ªæ–¹æ³•ã€‚

**å…·ä½“å·¥ä½œï¼š**
- `internal/acp/gateway/client.go`ï¼šWebSocket å®¢æˆ·ç«¯
  - è¿æ¥ `ws://localhost:18789`ï¼Œç”¨ `OPENCLAW_GATEWAY_TOKEN` è®¤è¯
  - è‡ªåŠ¨é‡è¿ï¼ˆæ–­çº¿åæŒ‡æ•°é€€é¿é‡è¿ï¼‰
  - è¯·æ±‚-å“åº”åŒ¹é…ï¼ˆJSON-RPC é£æ ¼ï¼Œç”¨ requestId å…³è”ï¼‰
- `internal/acp/gateway/types.go`ï¼šGateway å“åº”ç±»å‹å®šä¹‰
- å°è£…æ–¹æ³•ï¼š
  - `SessionsList()` â†’ è¿”å› agent åˆ—è¡¨ + åœ¨çº¿çŠ¶æ€ + æœ€è¿‘æ¶ˆæ¯
  - `SessionsHistory(sessionKey string, limit int, includeTools bool)` â†’ å¯¹è¯å†å²
  - `SessionsSend(sessionKey string, message string)` â†’ å‘é€æ¶ˆæ¯
  - `SessionStatus(sessionKey string)` â†’ token ç”¨é‡ + æ¨¡å‹ä¿¡æ¯
  - `CronList()` â†’ å®šæ—¶ä»»åŠ¡åˆ—è¡¨
- å•å…ƒæµ‹è¯•ï¼ˆmock WebSocketï¼‰

**å‚è€ƒï¼š**
- OpenClaw Gateway WebSocket åè®®ï¼šå‘é€ JSON `{type: "tool_call", tool: "sessions_list", params: {...}, requestId: "xxx"}`ï¼Œæ¥æ”¶ `{requestId: "xxx", result: {...}}`

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] Gateway å®¢æˆ·ç«¯èƒ½æˆåŠŸè¿æ¥å¹¶è·å– agent åˆ—è¡¨
- [ ] æ–­çº¿å 5s å†…è‡ªåŠ¨é‡è¿
- [ ] æ‰€æœ‰äº”ä¸ªæ–¹æ³•æœ‰å¯¹åº”çš„ Go å‡½æ•°ç­¾åå’Œç±»å‹å®šä¹‰
- [ ] è¯·æ±‚è¶…æ—¶ï¼ˆ30sï¼‰è¿”å›é”™è¯¯è€Œä¸æ˜¯æ°¸ä¹…é˜»å¡

**ä¾èµ–ï¼š** Task 1ï¼ˆé¡¹ç›®ç»“æ„ï¼‰
**å¤æ‚åº¦ï¼š** M
**ä¼˜å…ˆçº§ï¼š** P0

---

### Task 3: [åç«¯] Agent API + åˆå§‹åŒ–æ•°æ®

**æè¿°ï¼š**
å®ç° Agent ç›¸å…³çš„ HTTP APIï¼Œæ•´åˆ Gateway å®¢æˆ·ç«¯æ•°æ®ã€‚

**å…·ä½“å·¥ä½œï¼š**
- `internal/acp/handler/agent_handler.go`ï¼š
  - `GET /api/agents` â€” è°ƒç”¨ Gateway `sessions_list`ï¼Œåˆå¹¶æœ¬åœ° agents è¡¨é…ç½®ï¼Œè¿”å›åˆ—è¡¨
  - `GET /api/agents/:id` â€” è°ƒç”¨ `sessions_list` + `session_status`ï¼Œè¿”å›è¯¦æƒ…
  - `GET /api/agents/:id/history` â€” è°ƒç”¨ `sessions_history`ï¼Œæ”¯æŒ `?limit=50&before=xxx` åˆ†é¡µ
  - `POST /api/agents/:id/send` â€” è°ƒç”¨ `sessions_send`
  - `GET /api/agents/:id/cron-jobs` â€” è°ƒç”¨ `cron list`ï¼ŒæŒ‰ agent è¿‡æ»¤
- `internal/acp/service/agent_service.go`ï¼šä¸šåŠ¡é€»è¾‘å±‚
- å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ– agents è¡¨ï¼šå†™å…¥ main/pm/ux/alice å››ä¸ª agent çš„åŸºç¡€ä¿¡æ¯
- è·¯ç”±æ³¨å†Œåˆ° Gin

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] `GET /api/agents` è¿”å›4ä¸ªagentåŠå…¶åœ¨çº¿çŠ¶æ€
- [ ] `GET /api/agents/pm/history?limit=20` è¿”å›PMçš„æœ€è¿‘20æ¡å¯¹è¯
- [ ] `POST /api/agents/pm/send` èƒ½æˆåŠŸå‘é€æ¶ˆæ¯ç»™PM agent
- [ ] æ‰€æœ‰APIéœ€è¦JWTè®¤è¯

**ä¾èµ–ï¼š** Task 2ï¼ˆGateway å®¢æˆ·ç«¯ï¼‰
**å¤æ‚åº¦ï¼š** S
**ä¼˜å…ˆçº§ï¼š** P0

---

### Task 4: [å‰ç«¯] å…¨å±€å¸ƒå±€ + è·¯ç”± + Agent ç›‘æ§é¢æ¿

**æè¿°ï¼š**
å®ç°å‰ç«¯å…¨å±€å¸ƒå±€ã€è·¯ç”±é…ç½®å’Œ Dashboard é¡µé¢ï¼ˆAgent ç›‘æ§é¢æ¿ï¼‰ã€‚

**å…·ä½“å·¥ä½œï¼š**
- å…¨å±€å¸ƒå±€ï¼šé¡¶éƒ¨å¯¼èˆªæ ï¼ˆLogo "ACP" + å¯¼èˆªé“¾æ¥ï¼šDashboard / Tasks / Workflows / Settings + å³ä¾§é€€å‡ºæŒ‰é’®ï¼‰
- React Router è·¯ç”±é…ç½®ï¼ˆæ‰€æœ‰é¡µé¢è·¯ç”±ï¼‰
- AuthContextï¼šJWT å­˜å‚¨ + è‡ªåŠ¨è·³è½¬ç™»å½•
- API å±‚ï¼šaxios å®ä¾‹ + JWT æ‹¦æˆªå™¨ + åŸºç¡€ API å‡½æ•°
- **Dashboard é¡µé¢ `/`ï¼š**
  - å…¨å±€ç»Ÿè®¡æ ï¼šåœ¨çº¿ agent æ•° / ä»Šæ—¥ä»»åŠ¡æ•°ï¼ˆv1 æ˜¾ç¤º 0ï¼‰/ æ´»è·ƒå·¥ä½œæµæ•°ï¼ˆv1 æ˜¾ç¤º 0ï¼‰
  - Agent å¡ç‰‡ç½‘æ ¼ï¼ˆ2åˆ—æˆ–å“åº”å¼ï¼‰ï¼š
    - åç§° + è§’è‰²æ ‡ç­¾
    - åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºç¯ï¼ˆğŸŸ¢ç»¿/ğŸ”´çº¢ï¼‰
    - å½“å‰æ“ä½œæ‘˜è¦ï¼ˆæœ€è¿‘æ¶ˆæ¯æˆªå–å‰80å­—ç¬¦ï¼‰
    - Token ç”¨é‡è¿›åº¦æ¡
    - æœ€åæ´»è·ƒæ—¶é—´ï¼ˆç›¸å¯¹æ—¶é—´ï¼Œå¦‚"3åˆ†é’Ÿå‰"ï¼‰
  - ç‚¹å‡»å¡ç‰‡è·³è½¬ `/agents/:id`
  - 10s è‡ªåŠ¨åˆ·æ–°ï¼ˆ`setInterval` è½®è¯¢ï¼‰
  - ç¦»çº¿ agent ç°è‰²æ ·å¼ï¼Œæ’åœ¨åˆ—è¡¨æœ«å°¾

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] ç™»å½•åè·³è½¬åˆ° Dashboardï¼Œæ˜¾ç¤º 4 ä¸ª agent å¡ç‰‡
- [ ] åœ¨çº¿/ç¦»çº¿ agent è§†è§‰åŒºåˆ†æ˜æ˜¾
- [ ] æ¯ 10s è‡ªåŠ¨åˆ·æ–°æ•°æ®
- [ ] ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ° agent è¯¦æƒ…é¡µï¼ˆé¡µé¢å¯ä»¥æ˜¯ç©ºå ä½ï¼‰
- [ ] å¯¼èˆªæ å„é“¾æ¥å¯ç‚¹å‡»è·³è½¬

**ä¾èµ–ï¼š** Task 3ï¼ˆAgent APIï¼‰
**å¤æ‚åº¦ï¼š** M
**ä¼˜å…ˆçº§ï¼š** P0

---

### Task 5: [å‰ç«¯] Agent è¯¦æƒ…é¡µ

**æè¿°ï¼š**
å®ç° Agent è¯¦æƒ…é¡µï¼Œå±•ç¤ºå®æ—¶å¯¹è¯å†å²å’Œ tool call è¯¦æƒ…ã€‚

**å…·ä½“å·¥ä½œï¼š**
- **é¡µé¢è·¯ç”±ï¼š** `/agents/:id`
- **å·¦ä¾§é¢æ¿ï¼ˆ60%å®½åº¦ï¼‰â€” å¯¹è¯å†å²æµï¼š**
  - Chat UI æ ·å¼ï¼šuser æ¶ˆæ¯é å³ã€assistant æ¶ˆæ¯é å·¦
  - Tool call æ¶ˆæ¯ç‰¹æ®Šæ¸²æŸ“ï¼š
    - æŠ˜å å¡ç‰‡æ ·å¼ï¼šæ˜¾ç¤ºå·¥å…·å + å‚æ•°æ‘˜è¦ï¼ˆå‰100å­—ç¬¦ï¼‰
    - ç‚¹å‡»å±•å¼€å®Œæ•´å‚æ•°å’Œè¿”å›ç»“æœ
    - å·¥å…·åç”¨ tag/badge é«˜äº®
  - æ—¶é—´æˆ³åˆ†éš”ç¬¦ï¼ˆæ¯éš”30åˆ†é’Ÿä»¥ä¸Šæ˜¾ç¤ºæ—¶é—´ï¼‰
  - æ»šåŠ¨åŠ è½½æ›´å¤šå†å²ï¼ˆå‘ä¸Šæ»šåŠ¨è§¦å‘ load moreï¼‰
  - 5s è‡ªåŠ¨åˆ·æ–°ï¼ˆæ‹‰å–æœ€æ–°æ¶ˆæ¯è¿½åŠ åˆ°åº•éƒ¨ï¼‰
  - è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆæœ‰æ–°æ¶ˆæ¯æ—¶ï¼‰
- **å³ä¾§é¢æ¿ï¼ˆ40%å®½åº¦ï¼‰â€” çŠ¶æ€ä¾§è¾¹æ ï¼š**
  - Agent åŸºæœ¬ä¿¡æ¯å¡ç‰‡ï¼šIDã€æ¨¡å‹ã€è§’è‰²
  - Session ç»Ÿè®¡ï¼štoken ç”¨é‡ã€æ¶ˆæ¯æ€»æ•°
  - å…³è”çš„ cron jobs åˆ—è¡¨ï¼ˆåç§° + schedule + çŠ¶æ€ï¼‰
  - **å‘é€æ¶ˆæ¯è¾“å…¥æ¡†**ï¼šTextArea + å‘é€æŒ‰é’®ï¼Œå‘é€åæ¶ˆæ¯å‡ºç°åœ¨å·¦ä¾§å¯¹è¯æµ

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] è¿›å…¥è¯¦æƒ…é¡µååŠ è½½æœ€è¿‘ 50 æ¡å¯¹è¯è®°å½•
- [ ] tool call é»˜è®¤æŠ˜å ï¼Œç‚¹å‡»å±•å¼€/æ”¶èµ·
- [ ] å‘ä¸Šæ»šåŠ¨èƒ½åŠ è½½æ›´å¤šå†å²è®°å½•
- [ ] å‘é€æ¶ˆæ¯åï¼Œæ¶ˆæ¯ç«‹å³å‡ºç°åœ¨å¯¹è¯æµä¸­
- [ ] 5s è‡ªåŠ¨åˆ·æ–°è·å– agent æ–°å›å¤
- [ ] å³ä¾§æ˜¾ç¤ºæ­£ç¡®çš„ token ç”¨é‡å’Œ cron jobs

**ä¾èµ–ï¼š** Task 4ï¼ˆå¸ƒå±€ + è·¯ç”±ï¼‰
**å¤æ‚åº¦ï¼š** Lï¼ˆä½†å¯ä»¥åœ¨ä¸€ä¸ª session å®Œæˆï¼Œå› ä¸º API å·²å°±ç»ªï¼‰
**ä¼˜å…ˆçº§ï¼š** P0

---

### Task 6: [å…¨æ ˆ] æ„å»ºéƒ¨ç½² + è”è°ƒä¿®å¤

**æè¿°ï¼š**
å‰åç«¯è”è°ƒï¼Œä¿®å¤é›†æˆé—®é¢˜ï¼Œå®Œæˆæ„å»ºéƒ¨ç½²ã€‚

**å…·ä½“å·¥ä½œï¼š**
- å‰ç«¯ build â†’ æ‹·è´åˆ° `web/` ç›®å½•
- Go ç¼–è¯‘å•äºŒè¿›åˆ¶ï¼ˆå†…åµŒå‰ç«¯é™æ€æ–‡ä»¶ï¼‰
- éƒ¨ç½²åˆ° 43.134.86.237:3001
- è”è°ƒä¿®å¤ï¼šAPI å“åº”æ ¼å¼å¯¹é½ã€CORSã€WebSocket è¿æ¥ã€é”™è¯¯å¤„ç†
- ç¡®ä¿ Gateway è¿æ¥ç¨³å®šï¼ˆæµ‹è¯•æ–­çº¿é‡è¿ï¼‰
- æ·»åŠ  `.env.example` å’Œ README.md

**éªŒæ”¶æ ‡å‡†ï¼š**
- [ ] `make build` ç”Ÿæˆå•äºŒè¿›åˆ¶
- [ ] äºŒè¿›åˆ¶å¯åŠ¨å `:3001` å¯è®¿é—®å®Œæ•´åŠŸèƒ½
- [ ] Dashboard å±•ç¤ºçœŸå® agent æ•°æ®
- [ ] Agent è¯¦æƒ…é¡µå±•ç¤ºçœŸå®å¯¹è¯å†å²
- [ ] èƒ½å‘ agent å‘é€æ¶ˆæ¯å¹¶æ”¶åˆ°å›å¤

**ä¾èµ–ï¼š** Task 5
**å¤æ‚åº¦ï¼š** M
**ä¼˜å…ˆçº§ï¼š** P0

---

## ä»»åŠ¡ä¾èµ–å›¾

```
Task 1 (è„šæ‰‹æ¶+è®¤è¯)
  â””â†’ Task 2 (Gatewayå®¢æˆ·ç«¯)
       â””â†’ Task 3 (Agent API)
            â””â†’ Task 4 (Dashboardå‰ç«¯)
                 â””â†’ Task 5 (Agentè¯¦æƒ…é¡µ)
                      â””â†’ Task 6 (è”è°ƒéƒ¨ç½²)
```

å…¨éƒ¨ä¸²è¡Œï¼Œæ— å¹¶è¡Œä»»åŠ¡ï¼ˆCC åŒæ—¶åªèƒ½è·‘ä¸€ä¸ªï¼‰ã€‚

---

## P1 ä»»åŠ¡ï¼ˆåç»­æ‹†è§£ï¼‰

æš‚ä¸å±•å¼€ï¼Œå®Œæˆ P0 åå†ç»†åŒ–ï¼š

- **Task 7:** [å…¨æ ˆ] ä»»åŠ¡ç®¡ç† CRUD + åˆ—è¡¨é¡µ
- **Task 8:** [å‰ç«¯] ä»»åŠ¡çœ‹æ¿è§†å›¾ + æŒ‡æ´¾åŠŸèƒ½
- **Task 9:** [åç«¯] å·¥ä½œæµ YAML è§£æ + æ ¡éªŒ + å­˜å‚¨ API
- **Task 10:** [åç«¯] å·¥ä½œæµæ‰§è¡Œå¼•æ“ï¼ˆDAGè°ƒåº¦ + sessions_sendï¼‰
- **Task 11:** [å‰ç«¯] å·¥ä½œæµç¼–è¾‘å™¨ï¼ˆMonaco + YAMLé«˜äº®ï¼‰
- **Task 12:** [å‰ç«¯] å·¥ä½œæµæ‰§è¡Œè¯¦æƒ…é¡µï¼ˆæ­¥éª¤æ—¶é—´çº¿ï¼‰

---

## å˜æ›´è®°å½•

| æ—¥æœŸ | å˜æ›´ | åŸå›  |
|------|------|------|
| 2026-02-19 | åˆç‰ˆP0ä»»åŠ¡æ‹†è§£ | PRDå®Œæˆåæ‹†è§£å¼€å‘ä»»åŠ¡ |
