# 08 - AI集成与飞书

> 版本: v1.0 | 日期: 2026-02-19 | 编制: PM Agent
> 涵盖：飞书SSO/审批/通知、AI员工体系愿景(AI-OS)

---

## 一、飞书集成（已实现）

### 1.1 单点登录（SSO） ✅

**登录流程：**
1. 用户访问系统
2. 重定向飞书OAuth授权页
3. 用户在飞书登录（扫码/账号密码）
4. 飞书回调，携带authorization_code
5. 后端用code换取access_token → 获取用户信息
6. 颁发JWT Token → 用户进入系统

**设计原则**：系统不维护独立用户表，完全依赖飞书身份。

### 1.2 审批集成 ✅

| 审批场景 | 触发条件 |
|---------|---------|
| BOM审批 | 提交BOM审批时推送飞书审批卡片 |
| ECN审批 | 提交ECN审批时推送飞书审批卡片 |

- 飞书审批卡片：支持一键批准/驳回
- 审批结果自动回写系统

### 1.3 消息通知 ✅

| 事件 | 通知对象 | 通知方式 |
|-----|---------|---------|
| 任务分配 | 任务负责人 | 飞书消息 |
| 审批待办 | 审批人 | 飞书审批通知 |
| BOM审批通过 | 采购员 | 飞书消息（触发SRM） |
| 来料检验不通过 | 采购员+研发 | 飞书消息 |
| 交期预警 | 采购员 | 飞书消息 |

---

## 二、AI员工体系愿景（AI-OS，规划中）

### 2.1 核心理念

**用30人 + AI 实现5万人组织的运营能力。**

```
传统企业：人跑流程，系统记录
AI原生企业：AI跑业务，人做决策
```

### 2.2 AI员工清单（规划中）

| AI员工 | 所属部门 | 核心职责 | 自主级别 |
|-------|---------|---------|---------|
| 🤖 PLM管家 | 项目管理部 | 产品数据维护、BOM管理 | 3(人工监督) |
| 🤖 项目督导 | 项目管理部 | 任务跟踪、进度预警、日报生成 | 4(事后审计) |
| 🤖 采购专员 | 采购部 | 询价、下单、跟单 | 3 |
| 🤖 库存管家 | 仓储部 | 库存监控、预警 | 4 |
| 🤖 质量分析师 | 质量部 | 测试数据分析、异常预警 | 4 |

### 2.3 AI自主级别

| 级别 | 名称 | 说明 |
|-----|------|------|
| 1 | 仅建议 | AI提供建议，人类决策 |
| 2 | 人工确认 | AI准备好操作，人类确认后执行 |
| 3 | 人工监督 | AI自动执行，人类可随时干预 |
| 4 | 事后审计 | AI自主执行，定期人工审计 |
| 5 | 完全自主 | AI完全自主，仅异常时通知 |

### 2.4 典型场景

**场景1：自动补货**
```
🤖 库存管家 检测库存预警 → 通知 🤖 采购专员
🤖 采购专员 分析历史+推荐供应商 → @人类采购负责人确认
人类确认 → 🤖 采购专员 自动创建PO + 提交审批
```

**场景2：项目日报**
```
🤖 项目督导 每日9:00自动：
→ 收集所有进行中项目的任务状态
→ 对比昨日，识别变化
→ 检查延期/即将到期任务
→ 在项目群发送日报
→ 严重延期时私聊PM
```

**场景3：BOM变更评估**
```
工程师提交BOM变更
→ 🤖 PLM管家 自动分析：
  - 新旧BOM差异
  - 成本变化
  - 库存影响
  - 供应商影响
→ 生成评估报告附加到审批
→ 人类审批人参考AI报告做决策
```

### 2.5 技术架构

```
OpenClaw Gateway → 多个AI Agent Session
                    ├── 🤖 PLM管家
                    ├── 🤖 项目督导
                    ├── 🤖 采购专员
                    └── ...
                         │
                         ↓
                    共享工具层
                    ├── 飞书工具 (feishu_*)
                    ├── PLM工具 (plm_*)
                    ├── SRM工具 (srm_*)
                    └── 分析工具 (analytics_*)
```

### 2.6 安全边界

**AI不可执行的操作：**
- 删除产品/BOM/订单（只能标记废弃）
- 修改历史数据
- 直接付款执行
- 修改权限配置

**金额限制：**
- 采购专员：单笔PO上限5万

---

## 三、飞书多维表格集成（规划中）

### 3.1 用途

| 表格 | 用途 | 同步模式 |
|------|------|---------|
| 物料主数据 | 物料信息管理 | 双向同步 |
| 供应商管理 | 供应商信息 | 双向同步 |
| 采购订单 | 采购跟踪 | 双向同步 |
| 项目看板 | 项目进度 | 系统→表格 |

### 3.2 价值

- 人类员工可直接在飞书多维表格中操作，无需登录Web系统
- AI员工也可通过多维表格API读写数据
- 适合非技术人员使用

---

## 四、实施路线（规划中）

| 阶段 | 内容 |
|------|------|
| P0（已完成） | 飞书SSO + 审批 + 消息通知 |
| P1 | 飞书任务双向同步 |
| P2 | 多维表格同步 |
| P3 | 首批AI员工（PLM管家、项目督导） |
| P4 | 供应链AI（采购专员、库存管家） |
| P5 | 全面AI-OS |

---

*本文档基于已有飞书集成代码（auth_handler.go）和AI员工与飞书深度集成设计v1.0、nimo-AI-OS PRD v1.0整理。*
